<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<div class="dashboard-layout">
  <app-navbar-admin class="sidebar"></app-navbar-admin>
  <div class="main-content">
    <div class="container">
      <!-- Section: Aperçu Général -->
      <div class="section">
        <h2 class="section-title">Aperçu Général</h2>
        <div class="kpi-grid" *ngIf="!loading && statistics; else loadingTemplate">
          <div class="kpi-card" style="background: linear-gradient(135deg, #fef3c7, #fffbeb); border-left: 4px solid #f59e0b;">
            <i class="fas fa-users kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #d97706;">{{ statistics.kpiMetrics.totalUsers }}</p>
              <p class="kpi-label">Total Utilisateurs</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #e0f2fe, #f0f9ff); border-left: 4px solid #3b82f6;">
            <i class="fas fa-user kpi-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #2563eb;">{{ statistics.kpiMetrics.totalClients }}</p>
              <p class="kpi-label">Total Clients</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #fce7f3, #fdf2f8); border-left: 4px solid #ec4899;">
            <i class="fas fa-wrench kpi-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #db2777;">{{ statistics.kpiMetrics.totalTechnicians }}</p>
              <p class="kpi-label">Techniciens</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #e0e7ff, #eef2ff); border-left: 4px solid #8b5cf6;">
            <i class="fas fa-headset kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #7c3aed;">{{ statistics.kpiMetrics.totalGuichetiers }}</p>
              <p class="kpi-label">Guichetiers</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #d1fae5, #ecfdf5); border-left: 4px solid #10b981;">
            <i class="fas fa-file-alt kpi-icon" style="background: linear-gradient(135deg, #10b981, #059669);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #059669;">{{ statistics.kpiMetrics.totalRequests }}</p>
              <p class="kpi-label">Total Requêtes</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #ffedd5, #fff7ed); border-left: 4px solid #f59e0b;">
            <i class="fas fa-hourglass-half kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #d97706;">{{ statistics.kpiMetrics.activeRequests }}</p>
              <p class="kpi-label" title="Requêtes en attente de traitement">Requêtes Non Traitées</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #d1fae5, #ecfdf5); border-left: 4px solid #10b981;">
            <i class="fas fa-check-circle kpi-icon" style="background: linear-gradient(135deg, #10b981, #059669);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #059669;">{{ statistics.kpiMetrics.processedRequests }}</p>
              <p class="kpi-label">Requêtes Traitées</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #fee2e2, #fef2f2); border-left: 4px solid #ef4444;">
            <i class="fas fa-times-circle kpi-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #dc2626;">{{ statistics.kpiMetrics.refusedRequests }}</p>
              <p class="kpi-label">Requêtes Refusées</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #ffedd5, #fff7ed); border-left: 4px solid #f59e0b;">
            <i class="fas fa-cogs kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #d97706;">{{ statistics.kpiMetrics.inProgressRequests }}</p>
              <p class="kpi-label">Requêtes en Cours</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #e0f2fe, #f0f9ff); border-left: 4px solid #3b82f6;">
            <i class="fas fa-building kpi-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #2563eb;">{{ statistics.kpiMetrics.totalMinisteres }}</p>
              <p class="kpi-label">Ministères</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #fce7f3, #fdf2f8); border-left: 4px solid #ec4899;">
            <i class="fas fa-cog kpi-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #db2777;">{{ statistics.kpiMetrics.totalServices }}</p>
              <p class="kpi-label">Services</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #ffedd5, #fff7ed); border-left: 4px solid #f59e0b;">
            <i class="fas fa-box kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #d97706;">{{ statistics.kpiMetrics.totalProduits }}</p>
              <p class="kpi-label">Produits</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #e0e7ff, #eef2ff); border-left: 4px solid #8b5cf6;">
            <i class="fas fa-calendar-alt kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #7c3aed;">{{ statistics.kpiMetrics.totalRdvs }}</p>
              <p class="kpi-label">Total RDVs</p>
            </div>
          </div>
        </div>
        <ng-template #loadingTemplate>
          <div class="loading-spinner">Chargement des données...</div>
        </ng-template>
        <!-- Temps Moyen de Traitement KPI -->
        <div class="kpi-card temps-moyen" style="background: linear-gradient(135deg, #e0e7ff, #eef2ff); border-left: 4px solid #8b5cf6; margin-top: 1.5rem;" *ngIf="statistics">
          <i class="fas fa-stopwatch kpi-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></i>
          <div class="kpi-content">
            <p class="kpi-value" style="color: #7c3aed;">
              {{ statistics.kpiMetrics.avgProcessingTime.days > 0 || statistics.kpiMetrics.avgProcessingTime.hours > 0 || statistics.kpiMetrics.avgProcessingTime.minutes > 0 
                ? (statistics.kpiMetrics.avgProcessingTime.days + 'j ' + statistics.kpiMetrics.avgProcessingTime.hours + 'h ' + statistics.kpiMetrics.avgProcessingTime.minutes + 'm') 
                : 'N/A' }}
            </p>
            <p class="kpi-label">Temps Moyen de Traitement</p>
          </div>
        </div>
        <div class="chart-container" *ngIf="statistics">
          <h3 class="text-lg font-semibold mb-4">Indicateurs de Qualité des Requêtes</h3>
          <canvas #qualityChart baseChart [data]="pieChartData" [options]="qualityPieChartOptions" [type]="qualityPieChartType" *ngIf="hasNonZeroData(pieChartData); else noData"></canvas>
          <ng-template #noData>
            <p class="text-center text-gray-500">Aucune donnée disponible.</p>
          </ng-template>
        </div>
        <!-- Quality KPI Boxes -->
        <div class="kpi-grid" *ngIf="!loading && statistics">
          <div class="kpi-card" style="background: linear-gradient(135deg, #d1fae5, #ecfdf5); border-left: 4px solid #10b981;">
            <i class="fas fa-check-circle kpi-icon" style="background: linear-gradient(135deg, #10b981, #059669);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #059669;">{{ statistics.qualityMetrics.kpis.sameDay }}</p>
              <p class="kpi-label">Même Jour ({{ statistics.qualityMetrics.percentages.sameDay }}%)</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #ffedd5, #fff7ed); border-left: 4px solid #f59e0b;">
            <i class="fas fa-clock kpi-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #d97706;">{{ statistics.qualityMetrics.kpis.withinTwoDays }}</p>
              <p class="kpi-label">≤ 2 Jours ({{ statistics.qualityMetrics.percentages.withinTwoDays }}%)</p>
            </div>
          </div>
          <div class="kpi-card" style="background: linear-gradient(135deg, #fee2e2, #fef2f2); border-left: 4px solid #ef4444;">
            <i class="fas fa-exclamation-triangle kpi-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);"></i>
            <div class="kpi-content">
              <p class="kpi-value" style="color: #dc2626;">{{ statistics.qualityMetrics.kpis.moreThanTwoDays }}</p>
              <p class="kpi-label">> 2 Jours ({{ statistics.qualityMetrics.percentages.moreThanTwoDays }}%)</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Section: Requêtes -->
      <div class="section">
        <h2 class="section-title">Requêtes</h2>
        <div class="chart-filter">
          <label>Période :</label>
          <select [(ngModel)]="requestPeriod" (change)="loadRequestData()">
            <option value="7days">Derniers 7 jours</option>
            <option value="30days">Derniers 30 jours</option>
            <option value="custom">Personnalisé</option>
          </select>
          <div *ngIf="requestPeriod === 'custom'" class="flex space-x-2">
            <input type="date" [(ngModel)]="requestStartDate" (change)="loadRequestData()">
            <input type="date" [(ngModel)]="requestEndDate" (change)="loadRequestData()">
          </div>
        </div>
        <div class="chart-grid requests-charts" *ngIf="!loading; else loadingTemplate">
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Statut des Requêtes (Barres)</h3>
            <canvas #requestStatusBarChart baseChart [data]="barChartDataRequestStatus" [options]="barChartOptions" [type]="barChartType" *ngIf="hasNonZeroData(barChartDataRequestStatus); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Statut des Requêtes (Pie)</h3>
            <canvas #requestStatusPieChart baseChart [data]="pieChartDataRequestStatus" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(pieChartDataRequestStatus); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Requêtes par Ministère (Pie)</h3>
            <canvas #ministereChart baseChart [data]="ministereChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(ministereChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Requêtes par Services (Pie)</h3>
            <canvas #serviceChart baseChart [data]="serviceChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(serviceChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container" style="grid-column: 1 / -1;">
            <h3 class="text-lg font-semibold mb-4">Tendances des Requêtes (Ligne)</h3>
            <canvas #lineChart baseChart [data]="lineChartData" [options]="lineChartOptions" [type]="lineChartType" *ngIf="hasNonZeroData(lineChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Requêtes par Jour de la Semaine (Pie)</h3>
            <canvas #dayOfWeekChart baseChart [data]="dayOfWeekChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(dayOfWeekChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Temps Moyen de Traitement par Statut (Ligne)</h3>
            <canvas #avgProcessingTimeChart baseChart [data]="avgProcessingTimeChartData" [options]="avgProcessingTimeChartOptions" [type]="avgProcessingTimeChartType" *ngIf="hasNonZeroData(avgProcessingTimeChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
        </div>
        <!-- Historical Comparison -->
        <div class="historical-comparison">
          <h3 class="table-subtitle">Comparaison Historique (par Mois)</h3>
          <div class="chart-filter">
            <label>Plage de Mois :</label>
            <select [(ngModel)]="compareMonthRange" (change)="loadCompareData()">
              <option value="3">Derniers 3 mois</option>
              <option value="6">Derniers 6 mois</option>
              <option value="12">Derniers 12 mois</option>
            </select>
          </div>
          <div class="chart-grid">
            <div class="chart-container" style="grid-column: 1 / -1;">
              <h3 class="text-lg font-semibold mb-4">Tendances Mensuelles des Métriques (Ligne)</h3>
              <canvas #monthlyTrendChart baseChart [data]="monthlyTrendChartData" [options]="monthlyTrendChartOptions" [type]="monthlyTrendChartType" *ngIf="hasNonZeroData(monthlyTrendChartData); else noData"></canvas>
              <ng-template #noData>
                <p class="text-center text-gray-500">Aucune donnée disponible.</p>
              </ng-template>
            </div>
          </div>
        </div>
        <!-- Table: Liste des Requêtes -->
        <h3 class="table-subtitle">Liste des Requêtes</h3>
        <div class="search-bar-container">
          <div class="search-bar">
            <input type="text" placeholder="Rechercher une requête..." [(ngModel)]="requestSearch" (input)="filterRequests()">
            <button><i class="fas fa-search"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>Client</th>
                <th>État</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of displayedRequests">
                <td>{{ request.id }}</td>
                <td>{{ request.client?.username || 'N/A' }}</td>
                <td><span class="badge" [ngClass]="getRequestBadgeClass(request.etat)">{{ translateStatus(request.etat) }}</span></td>
                <td>{{ request.date ? (request.date | date:'dd/MM/yyyy') : 'N/A' }}</td>
              </tr>
              <tr *ngIf="displayedRequests.length === 0">
                <td colspan="4" class="text-center">Aucune requête trouvée.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <div class="pagination">
            <button [disabled]="page === 1" (click)="changePage(page - 1, 'requests')">«</button>
            <button *ngFor="let p of [1,2,3,4,5]" [class.active]="page === p" (click)="changePage(p, 'requests')">{{ p }}</button>
            <button [disabled]="page * pageSize >= totalRequestPages" (click)="changePage(page + 1, 'requests')">»</button>
          </div>
        </div>
      </div>

      <!-- Section: Utilisateurs -->
      <div class="section">
        <h2 class="section-title">Utilisateurs</h2>
        <div class="chart-filter">
          <label>Période :</label>
          <select [(ngModel)]="userPeriod" (change)="loadUserData()">
            <option value="7days">Derniers 7 jours</option>
            <option value="30days">Derniers 30 jours</option>
            <option value="custom">Personnalisé</option>
          </select>
          <div *ngIf="userPeriod === 'custom'" class="flex space-x-2">
            <input type="date" [(ngModel)]="userStartDate" (change)="loadUserData()">
            <input type="date" [(ngModel)]="userEndDate" (change)="loadUserData()">
          </div>
        </div>
        <div class="chart-grid" *ngIf="!loading; else loadingTemplate">
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Répartition des Rôles (Pie)</h3>
            <canvas #userRoleChart baseChart [data]="userRoleChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(userRoleChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Clients par Ministère (Pie)</h3>
            <canvas #clientByMinistereChart baseChart [data]="clientByMinistereChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(clientByMinistereChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
        </div>
        <!-- Table: Liste des Utilisateurs -->
        <h3 class="table-subtitle">Liste des Utilisateurs</h3>
        <div class="search-bar-container">
          <div class="search-bar">
            <input type="text" placeholder="Rechercher un utilisateur..." [(ngModel)]="userSearch" (input)="filterUsers()">
            <button><i class="fas fa-search"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>Nom d'utilisateur</th>
                <th>Rôle</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of displayedUsers">
                <td>{{ user.id }}</td>
                <td>{{ user.username }}</td>
                <td><span class="badge" [ngClass]="getRoleBadgeClass(user.role)">{{ translateRole(user.role) }}</span></td>
              </tr>
              <tr *ngIf="displayedUsers.length === 0">
                <td colspan="3" class="text-center">Aucun utilisateur trouvé.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <div class="pagination">
            <button [disabled]="page === 1" (click)="changePage(page - 1, 'users')">«</button>
            <button *ngFor="let p of [1,2,3,4,5]" [class.active]="page === p" (click)="changePage(p, 'users')">{{ p }}</button>
            <button [disabled]="page * pageSize >= totalUserPages" (click)="changePage(page + 1, 'users')">»</button>
          </div>
        </div>
      </div>

      <!-- Section: Rendez-vous -->
      <div class="section">
        <h2 class="section-title">Rendez-vous</h2>
        <div class="chart-filter">
          <label>Période :</label>
          <select [(ngModel)]="rdvPeriod" (change)="loadRdvData()">
            <option value="7days">Derniers 7 jours</option>
            <option value="30days">Derniers 30 jours</option>
            <option value="custom">Personnalisé</option>
          </select>
          <div *ngIf="rdvPeriod === 'custom'" class="flex space-x-2">
            <input type="date" [(ngModel)]="rdvStartDate" (change)="loadRdvData()">
            <input type="date" [(ngModel)]="rdvEndDate" (change)="loadRdvData()">
          </div>
        </div>
        <div class="chart-grid" *ngIf="!loading; else loadingTemplate">
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Statut des RDVs (Barres)</h3>
            <canvas #rdvStatusChart baseChart [data]="rdvStatusChartData" [options]="barChartOptions" [type]="barChartType" *ngIf="hasNonZeroData(rdvStatusChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Charge de Travail des Techniciens (Barres)</h3>
            <canvas #technicianWorkloadChart baseChart [data]="technicianWorkloadChartData" [options]="barChartOptions" [type]="barChartType" *ngIf="hasNonZeroData(technicianWorkloadChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
        </div>
        <!-- Table: Liste des RDVs -->
        <h3 class="table-subtitle">Liste des RDVs</h3>
        <div class="search-bar-container">
          <div class="search-bar">
            <input type="text" placeholder="Rechercher un RDV..." [(ngModel)]="rdvSearch" (input)="filterRdvs()">
            <button><i class="fas fa-search"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>Technicien</th>
                <th>Date</th>
                <th>Statut</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rdv of displayedRdvs">
                <td>{{ rdv.id || 'N/A' }}</td>
                <td>{{ rdv.technicien?.username || 'N/A' }}</td>
                <td>{{ rdv.dateSouhaitee ? (rdv.dateSouhaitee | date:'dd/MM/yyyy') : 'N/A' }}</td>
                <td><span class="badge" [ngClass]="getRdvBadgeClass(rdv.status)">{{ translateStatus(rdv.status) }}</span></td>
              </tr>
              <tr *ngIf="displayedRdvs.length === 0">
                <td colspan="4" class="text-center">Aucun RDV trouvé.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <div class="pagination">
            <button [disabled]="page === 1" (click)="changePage(page - 1, 'rdvs')">«</button>
            <button *ngFor="let p of [1,2,3,4,5]" [class.active]="page === p" (click)="changePage(p, 'rdvs')">{{ p }}</button>
            <button [disabled]="page * pageSize >= totalRdvPages" (click)="changePage(page + 1, 'rdvs')">»</button>
          </div>
        </div>
      </div>

      <!-- Section: Produits -->
      <div class="section">
        <h2 class="section-title">Produits</h2>
        <div class="chart-filter">
          <label>Période :</label>
          <select [(ngModel)]="productPeriod" (change)="loadProductData()">
            <option value="7days">Derniers 7 jours</option>
            <option value="30days">Derniers 30 jours</option>
            <option value="custom">Personnalisé</option>
          </select>
          <div *ngIf="productPeriod === 'custom'" class="flex space-x-2">
            <input type="date" [(ngModel)]="productStartDate" (change)="loadProductData()">
            <input type="date" [(ngModel)]="productEndDate" (change)="loadProductData()">
          </div>
        </div>
        <div class="chart-grid" *ngIf="!loading; else loadingTemplate">
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Top Produits (Pie)</h3>
            <canvas #productChart baseChart [data]="productChartData" [options]="pieChartOptions" [type]="pieChartType" *ngIf="hasNonZeroData(productChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
          <div class="chart-container">
            <h3 class="text-lg font-semibold mb-4">Tendances des Produits (Barres)</h3>
            <canvas #productTrendChart baseChart [data]="productTrendChartData" [options]="barChartOptions" [type]="barChartType" *ngIf="hasNonZeroData(productTrendChartData); else noData"></canvas>
            <ng-template #noData>
              <p class="text-center text-gray-500">Aucune donnée disponible.</p>
            </ng-template>
          </div>
        </div>
        <!-- Table: Liste des Produits -->
        <h3 class="table-subtitle">Liste des Produits</h3>
        <div class="search-bar-container">
          <div class="search-bar">
            <input type="text" placeholder="Rechercher un produit..." [(ngModel)]="productSearch" (input)="filterProducts()">
            <button><i class="fas fa-search"></i></button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>Nom</th>
                <th>Nombre de Requêtes</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let product of displayedProducts">
                <td>{{ product.id }}</td>
                <td>{{ product.nom }}</td>
                <td>{{ product.requestCount }}</td>
              </tr>
              <tr *ngIf="displayedProducts.length === 0">
                <td colspan="3" class="text-center">Aucun produit trouvé.</td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Pagination -->
        <div class="pagination-container">
          <div class="pagination">
            <button [disabled]="page === 1" (click)="changePage(page - 1, 'products')">«</button>
            <button *ngFor="let p of [1,2,3,4,5]" [class.active]="page === p" (click)="changePage(p, 'products')">{{ p }}</button>
            <button [disabled]="page * pageSize >= totalProductPages" (click)="changePage(page + 1, 'products')">»</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>